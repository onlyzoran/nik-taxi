!function(k){var a,e,t,r=(e=document.createElement("input"),t="onpaste",e.setAttribute(t,""),("function"==typeof e[t]?"paste":"input")+".mask"),n=navigator.userAgent,b=/iphone/i.test(n),y=/android/i.test(n);k.mask={definitions:{9:"[0-9]",a:"[A-Za-z]","*":"[A-Za-z0-9]"},dataName:"rawMaskFn",placeholder:"_"},k.fn.extend({caret:function(e,t){var n;if(0!==this.length&&!this.is(":hidden"))return"number"==typeof e?(t="number"==typeof t?t:e,this.each(function(){this.setSelectionRange?this.setSelectionRange(e,t):this.createTextRange&&((n=this.createTextRange()).collapse(!0),n.moveEnd("character",t),n.moveStart("character",e),n.select())})):(this[0].setSelectionRange?(e=this[0].selectionStart,t=this[0].selectionEnd):document.selection&&document.selection.createRange&&(n=document.selection.createRange(),e=0-n.duplicate().moveStart("character",-1e5),t=e+n.text.length),{begin:e,end:t})},unmask:function(){return this.trigger("unmask")},mask:function(t,d){var n,m,p,g,v;return!t&&0<this.length?k(this[0]).data(k.mask.dataName)():(d=k.extend({placeholder:k.mask.placeholder,completed:null},d),n=k.mask.definitions,m=[],p=v=t.length,g=null,k.each(t.split(""),function(e,t){"?"==t?(v--,p=e):n[t]?(m.push(new RegExp(n[t])),null===g&&(g=m.length-1)):m.push(null)}),this.trigger("unmask").each(function(){var o=k(this),c=k.map(t.split(""),function(e,t){if("?"!=e)return n[e]?d.placeholder:e}),i=o.val();function l(e){for(;++e<v&&!m[e];);return e}function s(e,t){var n,a;if(!(e<0)){for(n=e,a=l(t);n<v;n++)if(m[n]){if(!(a<v&&m[n].test(c[a])))break;c[n]=c[a],c[a]=d.placeholder,a=l(a)}f(),o.caret(Math.max(g,e))}}function u(e,t){var n;for(n=e;n<t&&n<v;n++)m[n]&&(c[n]=d.placeholder)}function f(){o.val(c.join(""))}function h(e){var t,n,a=o.val(),r=-1;for(pos=t=0;t<v;t++)if(m[t]){for(c[t]=d.placeholder;pos++<a.length;)if(n=a.charAt(pos-1),m[t].test(n)){c[t]=n,r=t;break}if(pos>a.length)break}else c[t]===a.charAt(pos)&&t!==p&&(pos++,r=t);return e?f():r+1<p?(o.val(""),u(0,v)):(f(),o.val(o.val().substring(0,r+1))),p?t:g}o.data(k.mask.dataName,function(){return k.map(c,function(e,t){return m[t]&&e!=d.placeholder?e:null}).join("")}),o.attr("readonly")||o.one("unmask",function(){o.unbind(".mask").removeData(k.mask.dataName)}).bind("focus.mask",function(){var e;clearTimeout(a),i=o.val(),e=h(),a=setTimeout(function(){f(),e==t.length?o.caret(0,e):o.caret(e)},10)}).bind("blur.mask",function(){h(),o.val()!=i&&o.change()}).bind("keydown.mask",function(e){var t,n,a,r=e.which;8===r||46===r||b&&127===r?(n=(t=o.caret()).begin,(a=t.end)-n==0&&(n=46!==r?function(e){for(;0<=--e&&!m[e];);return e}(n):a=l(n-1),a=46===r?l(a):a),u(n,a),s(n,a-1),e.preventDefault()):27==r&&(o.val(i),o.caret(0,h()),e.preventDefault())}).bind("keypress.mask",function(e){var t,n,a,r=e.which,i=o.caret();e.ctrlKey||e.altKey||e.metaKey||r<32||r&&(i.end-i.begin!=0&&(u(i.begin,i.end),s(i.begin,i.end-1)),(t=l(i.begin-1))<v&&(n=String.fromCharCode(r),m[t].test(n)&&(function(e){var t,n,a,r;for(t=e,n=d.placeholder;t<v;t++)if(m[t]){if(a=l(t),r=c[t],c[t]=n,!(a<v&&m[a].test(r)))break;n=r}}(t),c[t]=n,f(),a=l(t),y?setTimeout(k.proxy(k.fn.caret,o,a),0):o.caret(a),d.completed&&v<=a&&d.completed.call(o))),e.preventDefault())}).bind(r,function(){setTimeout(function(){var e=h(!0);o.caret(e),d.completed&&e==o.val().length&&d.completed.call(o)},0)}),h()}))}})}(jQuery);